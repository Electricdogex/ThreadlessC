<!doctype html>
<html lang="en" data-theme="forest">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ThreadlessCoin · Login</title>

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'none';
    form-action 'self';
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' https://cdn.jsdelivr.net https://cdn.skypack.dev 'unsafe-inline';
    connect-src 'self' https://*.supabase.co wss://*.supabase.co;
    upgrade-insecure-requests;">

  <meta name="robots" content="noindex, nofollow">

  <style>
    /* same theme system as index */
    :root{ --bg:#0e1613; --card:#122019; --ink:#e9f5ee; --muted:#9db7ab; --line:#1e2e27; --accent:#ff8b3d; --accent-2:#1f9d68; --accent-2-ink:#06120d; --warn:#ffd08f; --bad:#ff8c8c; --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif }
    [data-theme="forest"]{ --bg:#0e1613; --card:#122019; --ink:#e9f5ee; --muted:#9db7ab; --line:#1e2e27; --accent:#ff8b3d; --accent-2:#1f9d68; --accent-2-ink:#06120d; --warn:#ffd08f }
    [data-theme="sunset"]{ --bg:#160f12; --card:#22161b; --ink:#ffeef3; --muted:#c5a7b3; --line:#2d1e25; --accent:#ff6b6b; --accent-2:#ffb86b; --accent-2-ink:#2b130f; --warn:#ffe0b5 }
    [data-theme="midnight"]{ --bg:#0d0f19; --card:#121427; --ink:#e9ebff; --muted:#a9b0d4; --line:#1a1d36; --accent:#8ab4ff; --accent-2:#6ae6c1; --accent-2-ink:#021410; --warn:#ffd9a3 }
    [data-theme="ocean"]{ --bg:#07171d; --card:#0d2330; --ink:#e6fbff; --muted:#a6c9d6; --line:#143244; --accent:#26b0ff; --accent-2:#15d1b2; --accent-2-ink:#01221c; --warn:#ffe6b8 }
    [data-theme="grape"]{ --bg:#160d1a; --card:#231128; --ink:#f6e9ff; --muted:#c7abd8; --line:#31153b; --accent:#c47dff; --accent-2:#ff9fb3; --accent-2-ink:#2b0c18; --warn:#ffe0c1 }
    [data-theme="mono"]{ --bg:#0c0c0c; --card:#141414; --ink:#f5f5f5; --muted:#bcbcbc; --line:#202020; --accent:#fff; --accent-2:#d0d0d0; --accent-2-ink:#121212; --warn:#ffd08f }

    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 20% -10%, color-mix(in srgb, var(--card) 60%, transparent) 0%, transparent 60%),
        radial-gradient(1000px 800px at 120% -20%, color-mix(in srgb, var(--card) 60%, transparent) 0%, transparent 55%),
        var(--bg);
      color:var(--ink); font:16px/1.5 var(--font)
    }
    header{ position:sticky; top:0; z-index:3; background:linear-gradient(180deg, color-mix(in srgb, var(--card) 85%, transparent), transparent); backdrop-filter: blur(6px); border-bottom:1px solid var(--line) }
    .wrap{ max-width:860px; margin:0 auto; padding:16px }
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px }
    .brand{ display:flex; align-items:center; gap:12px }
    .logo{ width:32px;height:32px;border-radius:10px;background:var(--bg);border:1px solid var(--line); display:grid; place-items:center }
    .logo::after{ content:'¢'; color:var(--accent); font-size:20px }

    .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:20px; margin:20px 0; box-shadow:0 10px 30px rgba(0,0,0,.2) }
    input{ width:100%; padding:10px; border-radius:10px; border:1px solid var(--line); background:color-mix(in srgb, var(--bg) 90%, black 10%); color:var(--ink); font:inherit }
    input:focus{ outline:none; border-color:color-mix(in srgb, var(--accent-2) 60%, #000 40%); box-shadow:0 0 0 4px color-mix(in srgb, var(--accent-2) 20%, transparent) }
    .btn{ border:0; border-radius:12px; padding:10px 14px; background:linear-gradient(180deg, var(--accent), color-mix(in srgb, var(--accent) 75%, #000 25%)); color:#28150a; font-weight:800; cursor:pointer; box-shadow: 0 6px 18px color-mix(in srgb, var(--accent) 25%, transparent), inset 0 1px 0 rgba(255,255,255,.15) }
    .btn[disabled]{opacity:.55; cursor:not-allowed}
    .error{ color:var(--bad); font-size:13px; margin-top:6px }

    @media (max-width:720px){
      .wrap{ padding:12px }
      .topbar{ flex-wrap:wrap; align-items:flex-start }
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 style="margin:0 0 4px;font-size:22px">ThreadlessCoin</h1>
          <div style="color:var(--muted);font-size:13px">Sign in to start earning</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;color:var(--muted);font-size:12px">
        Theme:
        <select id="themeSelect">
          <option value="forest">Forest</option><option value="sunset">Sunset</option><option value="midnight">Midnight</option><option value="ocean">Ocean</option><option value="grape">Grape</option><option value="mono">Mono</option>
        </select>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="card" id="loginCard">
    <h2 style="margin-top:0">Sign In</h2>
    <form id="loginForm">
      <label>Email</label>
      <input id="loginEmail" type="email" required />
      <label>Password</label>
      <input id="loginPassword" type="password" required />
      <div class="error" id="loginError" style="display:none"></div>
      <button type="submit" class="btn" style="margin-top:12px;width:100%">Sign in</button>
    </form>
    <p style="margin-top:12px;font-size:14px">Don’t have an account?
      <a href="#" id="showSignup" style="color:var(--accent);text-decoration:none">Sign up</a></p>
  </div>

  <div class="card" id="signupCard" style="display:none">
    <h2 style="margin-top:0">Sign Up</h2>
    <form id="signupForm">
      <label>Email</label>
      <input id="signupEmail" type="email" required />
      <label>Password</label>
      <input id="signupPassword" type="password" required />
      <div class="error" id="signupError" style="display:none"></div>
      <button type="submit" class="btn" style="margin-top:12px;width:100%">Create account</button>
    </form>
    <p style="margin-top:12px;font-size:14px">Already have an account?
      <a href="#" id="showLogin" style="color:var(--accent);text-decoration:none">Sign in</a></p>
  </div>
</main>

<footer class="wrap" style="text-align:center;color:var(--muted);font-size:12px;margin:36px 0">
  © 2025 ThreadlessCoin. Earn while you idle.
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" crossorigin="anonymous"></script>
<script>
  // Theme persistence
  const themeSel = document.getElementById('themeSelect');
  const saved = localStorage.getItem('threadlesscoin_theme') || 'forest';
  document.documentElement.setAttribute('data-theme', saved);
  themeSel.value = saved;
  themeSel.addEventListener('change', ()=> {
    const t = themeSel.value; document.documentElement.setAttribute('data-theme', t);
    localStorage.setItem('threadlesscoin_theme', t);
  });

  // Supabase init (do NOT shadow the global)
  const SUPABASE_URL = "https://ltxuqodtgzuculryimwe.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx0eHVxb2R0Z3p1Y3VscnlpbXdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0ODAxMDksImV4cCI6MjA3NDA1NjEwOX0.nxGsleK3F0lsypzXtZeDPsy2I2JP3uJBtBtd2s5LkEI";
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); // per docs :contentReference[oaicite:5]{index=5}

  // Toggle forms
  document.getElementById('showSignup').addEventListener('click', (e)=>{ e.preventDefault(); loginCard.style.display='none'; signupCard.style.display='block'; });
  document.getElementById('showLogin').addEventListener('click', (e)=>{ e.preventDefault(); signupCard.style.display='none'; loginCard.style.display='block'; });

  // Login
  document.getElementById('loginForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = loginEmail.value.trim(), password = loginPassword.value;
    loginError.style.display='none';
    const { error } = await sb.auth.signInWithPassword({ email, password }); // :contentReference[oaicite:6]{index=6}
    if (error){ loginError.textContent = error.message || 'Login failed'; loginError.style.display='block'; return; }
    location.href = 'index.html';
  });

  // Signup
  document.getElementById('signupForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = signupEmail.value.trim(), password = signupPassword.value;
    signupError.style.display='none';
    const { data, error } = await sb.auth.signUp({ email, password });
    if (error){ signupError.textContent = error.message || 'Sign up failed'; signupError.style.display='block'; return; }
    const userId = data.user?.id;
    if (userId){
      // create balance row (0) so index doesn't 404
      await sb.from('balances').insert({ user_id: userId, balance: 0, last_generated: new Date().toISOString() });
    }
    location.href = 'index.html';
  });
</script>
</body>
</html>
